#! /usr/bin/env python2

import os
import sys
import logging
import argparse
import subprocess

def lookfor(*paths):
  ret = None
  for path in paths:
    if os.path.isfile(path):
      ret = open(path).read()

  if not ret:
    log.warning('Could not find any of {paths}'.format(**locals()))

  return ret

parser = argparse.ArgumentParser(description='Append basic logging/argparse template to a file')
parser.add_argument('file', help='File to `basicfy`')
parser.add_argument('-v', '--verbose', action='store_true', help='Enable debugging')
args = parser.parse_args()

logging.basicConfig(format='%(asctime)s %(levelname)s %(pathname)s:%(funcName)s:%(lineno)d %(msg)s')
log = logging.getLogger('basicfy')
log.setLevel(logging.DEBUG if args.verbose else logging.WARNING)

basic = lookfor(
  '{HOME}/python/basic'.format(**os.environ),
  '{pgm}/../python/basic'.format(pgm=os.path.dirname(sys.argv[0])),
)

if not basic:
  import requests

  url = 'https://raw.githubusercontent.com/pfuntner/fun/master/basic'
  log.info('GET {url}...'.format(**locals()))
  req = requests.get(url)
  if req.ok:
    basic = req.text
  else:
    log.warning('{url}: {req.status_code}, {req.text!r}'.format(**locals()))
    parser.error('Cannot locate basic template!')

with open(args.file, 'a') as work:
  work.write(basic)
  subprocess.Popen(['chmod', '-v', 'a+x', args.file]).wait()
