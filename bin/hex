#! /usr/bin/env python

import os
import sys
import logging
import argparse

def process(arg):
  stream = None
  if isinstance(arg, basestring):
    if os.path.exists(arg) and not os.path.isdir(arg):
      try:
        stream = open(arg)
      except Exception as e:
        log.warning('Cannot open {arg!r}: {e!s}'.format(**locals()))
    else:
      log.warning('Not a file: {arg!r}'.format(**locals()))
  else:
    stream = arg

  if stream:
    pos = 0
    while True:
      line1 = '{pos:08x}'.format(**locals())
      line2 = ' ' * 8
      buf = stream.read(width)
      if buf:
        for c in buf:
          line1 += '{c:>5}'.format(c=repr(c)[1:-1])
          line2 += ' '*3 + '{c:02x}'.format(c=ord(c))
        print line1
        print line2
      else:
        break
      pos += width

    if isinstance(arg, basestring):
      stream.close()

parser = argparse.ArgumentParser(description='Display files and data in hex and character form')
parser.add_argument('-v', '--verbose', dest='verbose', action='store_true', help='Enable debugging')
parser.add_argument('-8', dest='eight_byte_width', action='store_true', help='Display eight characters at a time')
parser.add_argument('files', metavar='file', nargs='*', help='Zero or more files')
args = parser.parse_args()

width = 8 if args.eight_byte_width else 16

logging.basicConfig(format='%(asctime)s %(levelname)s %(pathname)s:%(lineno)d %(msg)s')
log = logging.getLogger()
log.setLevel(logging.DEBUG if args.verbose else logging.WARNING)

if args.files:
  map(process, args.files)
else:
  process(sys.stdin)