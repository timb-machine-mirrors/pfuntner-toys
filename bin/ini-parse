#! /usr/bin/env python3

import sys
import json
import logging
import argparse
import configparser

parser = argparse.ArgumentParser(description='Using configparser to read a ini file')
parser.add_argument('file', nargs='?', help='Name of ini file to read')
parser.add_argument('-v', '--verbose', action='count', help='Enable debugging')
args = parser.parse_args()

logging.basicConfig(format='%(asctime)s %(levelname)s %(pathname)s:%(lineno)d %(msg)s')
log = logging.getLogger()
# log.setLevel(logging.DEBUG if args.verbose else logging.WARNING)
log.setLevel(logging.WARNING - (args.verbose or 0)*10)

if args.file:
  stream = open(args.file)
else:
  if sys.stdin.isatty():
    parser.error('stdin must be directed if a filename is not specified on command line')
  stream = sys.stdin

root = {}
config = configparser.ConfigParser()
config.read_file(stream)
for section in config.sections():
  root[section] = dict(config[section]) 

json.dump(root, sys.stdout)
print('')
