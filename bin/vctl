#! /usr/bin/env python

import logging
import argparse
from virtual_hosts import VirtualHosts

parser = argparse.ArgumentParser(description='Virtual machine control')
parser.add_argument('-p', '--profile', help='AWS profile')
parser.add_argument('-v', '--verbose', dest='verbose', action='store_true', help='Enable debugging')
parser.add_argument('action', choices=['start', 'stop', 'query'], help='Virtual machine operation')
parser.add_argument('hostname', help='Name of host')
args = parser.parse_args()

logging.basicConfig(format='%(asctime)s %(levelname)s %(pathname)s:%(lineno)d %(msg)s')
log = logging.getLogger()
log.setLevel(logging.DEBUG if args.verbose else logging.WARNING)

virtual_args = args.__dict__
virtual_args['aws_only'] = True
virtual_hosts = VirtualHosts(**virtual_args)
hosts = virtual_hosts.get_hosts(args.hostname)

if hosts:
  if len(hosts) == 1:
    pass
  else:
    parser.error('Multiple hosts found: {}'.format(sorted([host.name for host in hosts])))
